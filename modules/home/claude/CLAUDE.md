# Global Instructions for Claude Code

## 進め方（Workflow）

- 実装を行う前に必ず計画を立て、作業のスコープと影響範囲を明確にすること
- 計画を立てる際、不明な点は全て依頼者に質問し、確信を得られるまで作業を進めないこと
- 大きなタスクは小さなステップに分割し、各ステップごとに確認を取ること
- WebFetch を活用して公式ドキュメントやリリースノートなど確度の高い情報を精査すること
- 自信がない場合は無理に回答を出そうとせず、情報が不足している旨やわからない旨を素直に申し出ること
- 推測や仮定に基づいて作業を進める場合は、その旨を明示すること

## 言語設定（Language Settings）

- より質の高い分析を行うため、思考および推論のプロセスは英語で行うこと
- 出力や回答は全て日本語で行うこと
- 明確かつ正確な処理を行うため、内部処理は英語で行うこと
- コード中のコメントはプロジェクトの既存の慣習に合わせること（既存コメントがない場合は英語）

## コーディングスタイル（Coding Style）

- 言語やフレームワークのベストプラクティス・イディオムに従うこと
- 変更を加える前に関連するコードの文脈と意図を十分に理解すること
- セキュリティのベストプラクティスを遵守すること（ハードコードされた秘密情報、SQL インジェクション、XSS 等に注意）
- 既存のコードベースのスタイル・命名規則・パターンに一貫して合わせること
- マジックナンバーやハードコードされた値は定数として定義すること
- 適切なエラーハンドリングを実装し、エラーを握り潰さないこと
- 不要なコードやコメントアウトされたコードを残さないこと

## Git 操作（Git Practices）

- コミットメッセージは変更内容を端的に表す明確なものにすること
- 1つのコミットには1つの論理的な変更のみを含めること
- コミット前に差分を確認し、意図しない変更が含まれていないか検証すること
- `.gitignore` に含まれるべきファイル（環境変数、ビルド成果物、依存パッケージ等）をコミットしないこと

## テスト（Testing）

- t-wada（和田卓人）氏が提唱する TDD（テスト駆動開発）のサイクルに従うこと
  1. Red — まず失敗するテストを書く
  2. Green — テストを通す最小限のコードを書く
  3. Refactor — テストが通る状態を維持しながらリファクタリングする
- 新しい機能を追加する際は、対応するテストを先に作成すること
- バグ修正時は、そのバグを再現するテストケースを先に作成してから修正すること
- 既存のテストが壊れていないか確認すること

## ドキュメント（Documentation）

- 公開 API や複雑なロジックには適切なドキュメントやコメントを付与すること
- README や関連ドキュメントに影響する変更を加えた場合は、更新の要否と内容を依頼者に確認してから対応すること

## パフォーマンス（Performance）

- 明らかなパフォーマンス問題（N+1 クエリ、不要な再レンダリング、非効率なループ処理等）を発見した場合は依頼者に報告すること
- 修正が作業スコープ外の場合は、問題箇所と改善案を報告にとどめ、勝手に修正しないこと
- 新たに実装するコードでは、計算量やメモリ効率を意識した実装を心がけること

## スコープの厳守（Scope Management）

- 依頼された作業範囲を超えたリファクタリングや改善を勝手に行わないこと
- 作業中に気づいた改善点・技術的負債・潜在的なバグは、修正せず報告にとどめること
- スコープの拡大が必要と判断した場合は、理由を添えて依頼者に提案し承認を得ること

## 出力（Output）

- 作業結果やレポート等の出力を依頼された場合は、Markdown ファイル（`.md`）として作成すること
- ファイル名と保存先は依頼者に確認するか、プロジェクトの慣習に合わせること

## Pull Request / Changeset

- Pull Request を作成する際は、プロジェクトに changeset（`@changesets/cli` 等）が導入されているか確認すること
- changeset が必要な場合は、変更の差分に基づいて適切なバージョンレベルを判断すること
  - `patch` — バグ修正、内部リファクタリングなど後方互換性のある変更
  - `minor` — 新機能追加など後方互換性のある機能拡張
  - `major` — 破壊的変更（依頼者に確認の上で判断すること）
- changeset のサマリーは変更内容を端的に記述し、コミットに含めること

## 作業終了時のルール（Post-Task Checklist）

タスクが完了したら、以下を実施すること：

1. 変更内容のサマリーを日本語で報告すること
2. 作業中にユーザーが許可したコマンドを振り返り、`.claude/settings.json` の `allowedTools` に追加すべきコマンドを提案すること
   - 提案フォーマット例：
     - `Bash(git commit*)` — コミット操作
     - `Bash(npm run build)` — ビルド実行
3. 残存する既知の課題やリスクがあれば報告すること
4. 次のステップとして推奨するアクションがあれば提案すること
